<section class="search-wrapper">
  <h1 class="title">Trova il tuo volo ideale</h1>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="search-form">
    <div class="row full-width">
      <div class="field">
        <label for="from">Aeroporto di partenza <span class="required">*</span></label>
        <input id="from" type="text" formControlName="from" placeholder="Es: Roma, Milano...">
      </div>
    </div>

    <div class="row full-width">
      <div class="field">
        <label for="to">Aeroporto di arrivo</label>
        <input id="to" type="text" formControlName="to" placeholder="Es: New York, Tokyo...">
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label for="departDate">Data</label>
        <input id="departDate" type="date" formControlName="departDate" placeholder="gg/mm/aaaa">
      </div>
      <div class="field">
        <label for="passengers">Passeggeri</label>
        <input id="passengers" type="number" min="1" formControlName="passengers">
      </div>
    </div>

    <div class="row options-row">
      <div class="field switch-field">
        <label class="switch">
          <input id="oneWay" type="checkbox" formControlName="oneWay" (change)="onTripTypeChange()">
          <span class="slider"></span>
        </label>
        <label class="switch-label" for="oneWay">Solo voli diretti</label>
      </div>
      <div class="field sort-field">
        <label for="sort">Ordina per</label>
        <select id="sort" formControlName="sort">
          <option value="price">Prezzo (cres.)</option>
          <option value="depart">Data e ora partenza</option>
          <option value="duration">Tempo di percorrenza</option>
          <option value="stops">Numero di soste</option>
        </select>
      </div>
    </div>

    <div class="actions">
      <button class="btn btn-primary full" type="button" (click)="onSubmit()">✈️ Cerca voli</button>
    </div>
  </form>
</section>

<section *ngIf="searched" class="results-wrapper">
  <h2 class="section-title">Risultati ricerca</h2>

  <div *ngIf="results.length === 0" class="no-results">
    <p>Nessun volo trovato per questa ricerca.</p>
  </div>

  <div *ngFor="let res of results" class="result-card">
    <!-- Assuming "legs" array has at least one flight. Using first leg for main info for now -->
    <ng-container *ngIf="res.legs && res.legs.length > 0">
      <div class="card-header">
        <div class="route-info">
          <span class="city">{{ res.legs[0].from_airport.city }} ({{ res.legs[0].from_airport.code }})</span>
          <span class="arrow">→</span>
          <span class="city">{{ res.legs[res.legs.length-1].to_airport.city }} ({{
            res.legs[res.legs.length-1].to_airport.code }})</span>
        </div>
      </div>

      <div class="card-body">
        <div class="flight-meta">
          <span class="date">{{ res.legs[0].date_departure | date:'yyyy-MM-dd' }}</span>
          <span class="time">{{ res.legs[0].date_departure | date:'HH:mm' }}</span>
          <span class="seats-badge">Posti rimanenti: {{ res.available_seats }}</span>
        </div>

        <div class="airline-info">
          Airline: {{ getAirlineName(res.legs[0]) }}
        </div>
      </div>

      <div class="card-footer">
        <!-- Using total_price from response or fallback -->
        <button class="btn btn-book">
          Da €{{ res.total_price | number:'1.2-2' }} - Prenota
        </button>
      </div>
    </ng-container>
  </div>
</section>