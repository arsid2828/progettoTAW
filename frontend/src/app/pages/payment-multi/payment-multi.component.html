<main class="container">
  <div class="booking-card">
    <h1 class="booking-title">Pagamento Multiplo</h1>

    <ng-container *ngFor="let flight of flights">
      <div class="flight-summary" *ngIf="flight">
        <h2 class="section-title">Volo: {{ flight.from_airport?.name || '' }} → {{ flight.to_airport?.name || '' }}</h2>

        <div class="summary-item">
          <span class="summary-label">Compagnia:</span>
          <span class="summary-value">{{ flight.airline?.name || flight.airline }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Data:</span>
          <span class="summary-value">{{ flight.date_departure | date:'dd MMMM yyyy' }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Orario:</span>
          <span class="summary-value">{{ flight.date_departure | date:'HH:mm' }} → {{ flight.date_arrival | date:'HH:mm
            dd/MM/yyyy' }}</span>
        </div>
      </div>

      <h3 class="section-title" style="font-size: 1rem; margin-top: 10px;">Riepilogo passeggeri per questa tratta</h3>
      <div class="flight-list">
        <div class="flight-item" *ngFor="let it of getPassengersByFlight(flight._id)">
          <div class="flight-details" style="justify-content:space-between;flex-wrap:wrap;">
            <span><strong>{{ it.passenger?.nome }} {{ it.passenger?.cognome }}</strong></span>
            <span>Bagaglio: <strong>{{ it.bag_label }}</strong></span>
            <span>Posto: <strong>{{ it.seat_label }}</strong></span>
            <span *ngIf="it.seat_fee && it.seat_fee > 0">Extra posto: <strong>€{{ it.seat_fee.toFixed(2)
                }}</strong></span>
            <span>Prezzo: <strong>€{{ it.price.toFixed(2) }}</strong></span>
          </div>
        </div>
      </div>
      <div class="divider"></div>
    </ng-container>

    <div class="summary-item" style="justify-content:flex-end;">
      <span class="summary-label" style="min-width:auto;margin-right:.5rem;">Totale Complessivo:</span>
      <span class="summary-value" style="font-weight:700;">€{{ total.toFixed(2) }}</span>
    </div>

    <div class="divider"></div>

    <h2 class="section-title">Dati di pagamento</h2>
    <form class="airline-form" (submit)="pay(); $event.preventDefault();">
      <div class="form-group">
        <label for="cc_name">Nome sulla carta</label>
        <input id="cc_name" name="cc_name" placeholder="Mario Rossi" required />
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="cc_number">Numero carta</label>
          <input id="cc_number" name="cc_number" inputmode="numeric" autocomplete="cc-number"
            placeholder="1234 5678 9012 3456" required />
        </div>
        <div class="form-group">
          <label for="cc_cvv">CVV</label>
          <input id="cc_cvv" name="cc_cvv" inputmode="numeric" autocomplete="cc-csc" placeholder="123" required />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="cc_exp_month">Mese scadenza</label>
          <select id="cc_exp_month" name="cc_exp_month" required>
            <option value="">MM</option>
            <option *ngFor="let m of [1,2,3,4,5,6,7,8,9,10,11,12]" [value]="m">{{ ('0' + m).slice(-2) }}</option>
          </select>
        </div>
        <div class="form-group">
          <label for="cc_exp_year">Anno scadenza</label>
          <select id="cc_exp_year" name="cc_exp_year" required>
            <option value="">YYYY</option>
            <option *ngFor="let y of [2025,2026,2027,2028,2029,2030,2031,2032]" [value]="y">{{ y }}</option>
          </select>
        </div>
      </div>

      <div style="margin-top:12px">
        <button class="btn btn-submit" type="submit" [disabled]="loading">Paga €{{ total.toFixed(2) }}</button>
        <a class="btn btn-outline" routerLink="/biglietti">Annulla</a>
      </div>
      <div *ngIf="error" class="flash-messages">
        <div class="flash-message">{{ error }}</div>
      </div>
    </form>
  </div>
</main>